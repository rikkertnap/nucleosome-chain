# Nucleosome


## Description

Uses the molecular theory approach to compute the structure and charge of a nucleosome n-mer in 3D in 
cartesian and oblique (prism and hexagonal) coordinates. 
The aqueous solution is characterized by pH, and salt concentration of NaCl, KCl, CaCl2 and MgCl2.
The nucleoeosome chains or conformation are obtained from simulation using the 1CPN-model. 
The 1CPN trajectory are inverted and mapped back to amino-acid unit resolution of the 3SPN-AIGC model, inwhich DNA is represented by 3 sites. Namly 
P(phosphate), S( sugar) and an nucliotude (A, T, G, and C ). The amino-acid residue is represented by one site.
Formation of Ca-bridges between phosphate monomer is taken into account.
Program has inherited features and input variables of other codes such as srcf90-fdis5-3D, which solved in 3D a end-tethered polyelectroltye layer 
of arbitrair composition. Hence beside nucleomse it can alos represent copolymers, whose confoamtions are generated internal using the RIS model. 


### Prerequisites

The program uses the kinsol solver form the library package sundials.
Sundials/kinsol, version 2.5/2.6.1.

### Installing

Modify Makefile such that in contains the appropriate linker flags to the sundials library.
Linker flags can be obtained from the examples directory of the sundials installation.



### Running
The program requires a number of input files describe below.
A central configuration file is called 'input.in' that contain following key words.


| Keyword (type)     	    | Description                       | Value                                                  |
| ------------------------|-----------------------------------|--------------------------------------------------------|
| method `char`		        | Selects solver KINSOL		          | __KINSOL__                                            |
| chainmethod `char` 	    | Selects method of chain generation | __MC__: conformation generated by Monte Carlo         |
|    	                    |                                    | __FILE__XYZ__ : conformations from lammps-format file: traj<rank>.xyz |
| chaintype `char`        | Sets sequence monomers in  chain.  | __diblockA__: diblock copolymer A-block-B chain length A block set by Keyword `chainperiod` |
|                           |                               | __diblockB__: idem to but B block is first : copolymer B-block-A chain| 
| 	                        | 	                            | __altA__: alternating copolymer A-alt-B mod(s,chainperiod)!=0 is A monomer|
|			                      |                               | __altB__: alternating copolymer B-alt-A mod(s,chainperiod)=0 is A monomer |
|		                        |                               | __copolyAB__: Arbitrary AB copolysequence. Read in from sequence.in |
|                           |                               | __multi__: Arbitrary multi component sequnce. Read in from file named in `typesfname`.|
| systype  `char`           | Sets the type of system		    | __elect__: weak polyacid no VdW interaction single surface tethered|
|                           |                       		    | __neutral__:  neutral polymer plus VdW interaction |
|                           |                       		    | __neutralnoVdW__:  neutral polymer no VdW interaction |
|                           |                               | __brush_mul__: multi-component acid-base: VdW interaction |
|                           |                               | __brush_mulnoVdW__: multi-component acid-base: noVdW interaction  |
|                           |                               | __brushborn__ : idem brush plus varing Born Energy  |
|                           |                               | __brushdna__  : multi-component acid-base plus one acid with Ca/Mg binding |
|                           |                               | __nucl_ionbin__ : nucleosome with ionbinding to both phosphate and AAs |
|                           |                               | __nucl_ionbin_sv__ : nucleosome with ionbinding to both phosphate and AAs | 
|                           |                               |                      volume distributed |
|runtype`char`              | Sets type of run              | __inputcspH__ : loop over pH salt concentration from file salt.in|
|                           |   	                          | __inputMgpH__ : loop over pH Mg salt concentration from file saltMg.in |
|                           |                               | __inputcsKClpH__ : loop over pH K salt concentration from file salt.in | 
|                           |   	                          | __rangedist__ : loop over distance between plates  |
|                           |                               | __rangepKd__: loop over pKd2 Mg salt concentration  from file saltMg.in |   
|                           |                               | __rangeVweps__: loop over VdWScale VdW parameters |   
|isChainEnergyFile `logical`|                               | __True__ reads traj<rank>.ene containing energy of conformation read from file |
|                           |                               | __False__                              |
|isEnergyshiftFile `logical`|                               | not used |
|tolerance `real`		      	| Tolerance, maximum allowed error non-linear solver||  
|infile `int`		            | Select initial guess for non-linear solver |__0__:  homogenous guess initial guess |
|		                        |                                            |__1__: read guess from a input file |
|pH%val `real`              | pH value    ||
|pH%min `real`			        | Minimal pH value||
|pH%max `real`	            | Maximum pH value||
|pH%stepsize `real`         | Stepsize pH value ||
|pH%delta `real`            | Minimal allowed stepsize. Stopping criteria||
|KionNa `real`              | dissociation constant of NaCl| __0__  : complete dissociation|
|   	                      |                              | __0.60__ : suggested value for NaCl|
|KionK `real`			          | dissociation constant of KCl | |
|cNaCl `real`               | concentration of NaCl value    |  |
|cKCl `real`                | concentration of KCl value      |  |
|cRbCl `real`               | concentration of RbCl value     |   | 
|cCaCl2 `real`              | concenrration of CaCl2 value    |   |
|cMgCl2 `real`              | concentration of MgCl2 value    |   |
|nsize `int` 		            | Number of lattice sites nsize=nx ny nz ||
|nnucl `int`                | Number of nucleosomes    ||
|nseg  `int`		            | Number of segments       ||
|nsegtypes `int`            | Number of segments types          ||
|cuantas `int`              | Number of conformations ||
|chainperiod `int`          | Set length diblock or alternating polymer,| |  
|                           | works together with chaintype.            | |  
|vpolfname `char`           | name file containing segment volume of all types ||
|typesfname `char`          | name file containing list of all types ||
|pKafname `char`            | name file containing pKa and charge of all types ||
|pKaionfname `char`         | name file containing pKa add pKd of ionbindig AA and charge of all types || 
|lsegfname `char`           | name file containing segment lenght of all types ||
|segcmfname `char`          | name file containing the segment id segcmfname | |
|nx `int`                   | number of lattice cells in x-direction. Unit: delta ||
|ny `int`                   | number of lattice cells in y-direction. Unit: delta || 
|nz `int`		                | number of lattice cells in z-direction. Unit: delta || 
|verboseflag `char`			    | Regulates verbosity of output files |__yes__: all density outputted|
|                           |                                     | __no__: density of all ions omitted|
|delta `int`			          | size of one lattice cell      Unit: nm           ||
|unit_conv `real`		      	| Scaling of coordinates of conformations       | unit_conv = 1.0 assume unit conf is nm|
|                           | that are read in from  FILE                   | unit_conv = 0.1 assume unit conf is Angstrom |     
|geometry `char`            | set geometry or shape of lattice  | __cubic__ : Cartesian lattice |
|                           |                                   | __prism__ : oblique lattice   |
|sgraft `int`               | Segment id numbers of three residue that are used | triplet of int | 
|                           | to rotate and tranlate the nucluesome chain      ||                
|gamma `real`               | angle between the none-orthogonal prism basis vectors, unit: radian | |
|write_mc_chain `logical`   | if .true. writes MC chain to file  ||  
|precondition `logical`     | if precondition==".true."  precondition | __.false.__ : default if not set |
|maxniter `int`             | maximum of nonlinear iterations | if not set : default maxiter=1000 |
|maxfkfunevlas `int`        | maximum of fcn evaluations | if not set : default maxfkfunevlas=1000 |
|dielect_env `char`         | Selects the dielect function                         | __linear__ |
|                           | only used for systype="brushvarelec" and "brushborn" | __constant__ |
|                           |                                                      | __MaxwellGarnett__ |     
|                           | Following variables describe VdW interactions. | |
|VdWeps%val `real`	        | Strength VdW parameter 	Unit: kBT    |  |
|VdWeps%min `real`		      | Minimum strength VdW parameter  Unit: kBT    |  |
|VdWeps%max `real`			    | Maximum strength VdW parameter  Unit: kBT    |  |
|VdWeps%stepsize `real`	    | Stepsize strength VdW parameter     Unit: kBT  | |
|VdWeps%delta `real`	      | Minimal allowed stepsize. Stopping criteria  Unit: kBT    | |
|pKd%val `real`	            | Strength pKd parameter 	    |  |
|pKd%min `real`			        | Minimum strength pKd parameter    |  |
|pKd%max `real`			        | Maximum strength pKd parameter      |  |
|pKd%stepsize `real`	      | Stepsize strength pKd parameter     |  |
|pKd%delta `real`			      | Minimal allowed stepsize. Stopping criteria    |  |
|write_struct `logical`     | if .true. writing of nucleosome chain properties to file ||
|                           | bond angle, dihedral angle, Rend-to-end, Radius of gyration | if not set default: __.false.__| 
|                           | and inter nucleosome spacing or distance  ||
|write_rotations `logical`  | if .true. extra output on  nucleosome chain rotation calculation | if not set default: __.false.__|

Format other input files:
 
* input file 'salt.in' if runtype="inputcspH" or "inputcsT" or "inputcssigma". Values of salt concentration read in from file the input file. First line indicates the number of salt concentrations to be considered. Subsequent lines are the values of the salt concentrations.'
* input file 'saltMg.in' contains Mg2+ concentrations  if runtype="inputMgpH" or "rangepKd" or "rangeVdWeps". Format similar to "salt.in".
* Input file 'vdwcoeff_lseg\<val\>_\<geometry\>.dat'  contains distance dependent part VdW interaction.
* Input file  'VdWeps.in' constains epsilon parameters of VdW interaction. Format matrix.
* Input file '\<lsegfname\>' contains length segments. Format list.
* Input file '\<vpolname\>' contains volume segments. Format list.
* Input file 'pKdacid.in' Aicd and Na/Ca/Mg ion dissociation constants. <br/>
If file absent, values set for acrylic acids <br/>
* Input file '\<pKafname\>' constains pKa for acid or base,br/>
 Format file: pKavalue zcharge-reactant zcharge-product.<br/>
 For AH<=> A^-+ H^+ : zcharge-reactant = "0" and zcharge-product="-1"<br/>
 For BH^+ <=> B+ H^+ : zcharge-reactant = "1" and zcharge-product="0"<br/>
* Input file '\<pKaionfname\>' similar to file '\<pKafname\>' plus for every AA acid binding constant with Na and K <br/>
 For AA base  binding constant with Cl  
* Input file '\<typesfname\>' constains segment identifier number and char for every segment number.<br/>
  Segment identifier "P" selects (phosphate)acid that can involved ion binding.
* Input file '\<segcmfname\>' contains segment id number of residue that is assigned the COM of one nucleosome.<br/>
  For nnucl array there are nnucl id required.
* The program is a parrallel program. Every mpi_node holds it own set of 'cuantas' conformations.

Redundant variables: bcflag(RIGHT),bcflag(LEFT),sigmaSurfR,sigmaSurfL

## Built With

* [Sundials](https://computation.llnl.gov/projects/sundials/)


## Versioning

version 0.34 01-18-2022

## Authors

* **Rikkert J Nap**
